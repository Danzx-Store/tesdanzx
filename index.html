<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo Checkout — DANA / QRIS (Simulasi)</title>
  <style>
    :root{--accent:#2563eb}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;margin:0;padding:20px;background:#f7f8fb;color:#111}
    .card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(20,20,50,0.06);max-width:880px;margin:18px auto}
    h1{font-size:20px;margin:0 0 12px}
    .steps{display:flex;gap:8px;margin-bottom:12px}
    .step{flex:1;padding:8px;border-radius:8px;text-align:center;background:#eef2ff;color:#3b3b7a}
    .hidden{display:none}
    .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .product{border:1px solid #e6e9f2;border-radius:10px;padding:10px}
    .center{text-align:center}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    input[type=number]{width:70px}
    .row{display:flex;gap:8px;align-items:center}
    .right{text-align:right}
    footer{font-size:13px;color:#666;margin-top:12px}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Demo Checkout multi-step — Pilih Produk & Bayar (DANA / QRIS)</h1>
    <div class="steps">
      <div id="step-pill-1" class="step">1. Buka Web</div>
      <div id="step-pill-2" class="step">2. Pilih Produk</div>
      <div id="step-pill-3" class="step">3. Checkout</div>
      <div id="step-pill-4" class="step">4. Pembayaran</div>
    </div><!-- STEP 1 -->
<section id="step-1">
  <p>Simulasi: halaman produk terbuka. Kamu bisa pilih produk manual, atau gunakan tombol "Auto-pilih" untuk memilih beberapa produk secara otomatis.</p>
  <div class="row">
    <button id="to-step-2">Lihat Produk</button>
    <label style="margin-left:12px"><input type="checkbox" id="auto-open" /> Buka otomatis produk pada load (simulasi)</label>
  </div>
</section>

<!-- STEP 2 -->
<section id="step-2" class="hidden">
  <div class="row" style="justify-content:space-between;margin-bottom:8px">
    <div class="muted">Daftar produk</div>
    <div class="row">
      <button id="auto-select">Auto-pilih Produk</button>
      <button id="to-cart">Lihat Keranjang</button>
    </div>
  </div>

  <div class="products" id="products-list"></div>
</section>

<!-- STEP 3 CART -->
<section id="step-3" class="hidden">
  <h2>Keranjang</h2>
  <div id="cart-items"></div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
    <div class="muted">Pilih metode pembayaran:</div>
    <div class="row">
      <label><input type="radio" name="pay" value="dana" checked /> DANA</label>
      <label style="margin-left:8px"><input type="radio" name="pay" value="qris" /> QRIS</label>
      <button id="pay-now" style="margin-left:12px">Bayar & Arahkan</button>
    </div>
  </div>
</section>

<!-- STEP 4 PAYMENT STATUS -->
<section id="step-4" class="hidden">
  <h2>Status Pembayaran</h2>
  <p id="payment-status">Menunggu proses pembayaran...</p>
  <div id="payment-data" class="muted"></div>
</section>

<footer>
  <div>Catatan: ini adalah <strong>simulasi frontend</strong>. Untuk integrasi nyata DANA/QRIS kamu butuh backend & API resmi dari provider.</div>
</footer>

  </div>  <script>
    // Produk sample
    const products = [
      {id:1, name:'Kaos Polos', price:55000},
      {id:2, name:'Celana Jeans', price:120000},
      {id:3, name:'Jaket Hoodie', price:185000},
      {id:4, name:'Topi Baseball', price:45000},
      {id:5, name:'Sepatu Sneakers', price:320000}
    ];

    // Keranjang sederhana
    let cart = [];

    // UI helpers
    const show = id => document.getElementById(id).classList.remove('hidden');
    const hide = id => document.getElementById(id).classList.add('hidden');
    const setActiveStepPill = n => {
      [1,2,3,4].forEach(i=>document.getElementById('step-pill-'+i).style.background = i===n? 'linear-gradient(90deg,#e0e7ff,#c7d2fe)':'#eef2ff');
    }

    // Render daftar produk
    function renderProducts(){
      const list = document.getElementById('products-list');
      list.innerHTML = '';
      products.forEach(p=>{
        const el = document.createElement('div'); el.className='product';
        el.innerHTML = `<div><strong>${p.name}</strong></div>
                        <div class="muted">Rp ${p.price.toLocaleString('id-ID')}</div>
                        <div style="margin-top:8px" class="row">
                          <label>Qty: <input type="number" min="0" value="0" data-id="${p.id}" style="margin-left:6px" /></label>
                          <button data-add="${p.id}">Tambah</button>
                        </div>`;
        list.appendChild(el);
      });

      // attach handlers
      list.querySelectorAll('[data-add]').forEach(btn=>btn.addEventListener('click',e=>{
        const id = Number(e.currentTarget.dataset.add);
        const input = document.querySelector(`input[data-id='${id}']`);
        const qty = Number(input.value) || 0;
        if(qty<=0){ alert('Silakan pilih qty > 0'); return; }
        addToCart(id, qty);
      }));
    }

    function addToCart(productId, qty){
      const p = products.find(x=>x.id===productId);
      const found = cart.find(x=>x.id===productId);
      if(found) found.qty += qty; else cart.push({id:p.id, name:p.name, price:p.price, qty});
      alert(qty + ' x ' + p.name + ' ditambahkan ke keranjang');
    }

    function renderCart(){
      const container = document.getElementById('cart-items');
      if(cart.length===0){ container.innerHTML = '<div class="muted">Keranjang kosong</div>'; return; }
      let html = '<table style="width:100%"><thead><tr><th>Produk</th><th>Qty</th><th class="right">Subtotal</th></tr></thead><tbody>';
      let total = 0;
      cart.forEach(it=>{
        const sub = it.price * it.qty; total += sub;
        html += `<tr><td>${it.name}</td><td>${it.qty}</td><td class="right">Rp ${sub.toLocaleString('id-ID')}</td></tr>`;
      });
      html += `</tbody></table><div style="display:flex;justify-content:space-between;margin-top:12px"><strong>Total</strong><strong>Rp ${total.toLocaleString('id-ID')}</strong></div>`;
      container.innerHTML = html;
    }

    // tombol & flow
    document.getElementById('to-step-2').addEventListener('click', ()=>{
      hide('step-1'); show('step-2'); setActiveStepPill(2);
      renderProducts();
    });

    document.getElementById('auto-select').addEventListener('click', ()=>{
      // Auto pilih 2 produk random
      cart = [];
      const picks = [products[Math.floor(Math.random()*products.length)], products[Math.floor(Math.random()*products.length)]];
      picks.forEach(p=>cart.push({id:p.id,name:p.name,price:p.price,qty:1}));
      alert('Auto-pilih selesai: 2 produk ditambahkan ke keranjang');
    });

    document.getElementById('to-cart').addEventListener('click', ()=>{
      hide('step-2'); show('step-3'); setActiveStepPill(3);
      renderCart();
    });

    document.getElementById('pay-now').addEventListener('click', ()=>{
      if(cart.length===0){ alert('Keranjang kosong — pilih produk dulu'); return; }
      const method = document.querySelector('input[name=pay]:checked').value;
      const amount = cart.reduce((s,i)=>s+i.qty*i.price,0);
      // Siapkan payload pembayaran — di implementasi nyata kirim ke backend
      const payload = {orderId: 'ORD'+Date.now(), amount, method, items: cart};
      // Arahkan ke halaman/payment provider (simulasi)
      openPaymentWindow(payload);
      hide('step-3'); show('step-4'); setActiveStepPill(4);
      document.getElementById('payment-status').innerText = 'Mengalihkan ke provider pembayaran ('+method.toUpperCase()+')...';
      document.getElementById('payment-data').innerText = JSON.stringify(payload, null, 2);
    });

    // Simulasi membuka halaman provider (menggunakan blob URL) — pada integrasi nyata: redirect ke endpoint server / provider
    function openPaymentWindow(payload){
      const {method, amount, orderId} = payload;
      const html = `<!doctype html><html><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><title>Pembayaran (${method.toUpperCase()})</title></head><body style=\"font-family:Arial;padding:20px\">`+
        `<h2>Pembayaran (Simulasi) - ${method.toUpperCase()}</h2>`+
        `<p>Order: <strong>${orderId}</strong></p>`+
        `<p>Jumlah: <strong>Rp ${amount.toLocaleString('id-ID')}</strong></p>`+
        `${method==='qris'? '<p>Scan QR berikut (simulasi)</p><div style=\"width:200px;height:200px;background:#eee;display:flex;align-items:center;justify-content:center;border:1px solid #ddd\">QRIS</div>':''}
        <div style=\"margin-top:18px\">`+
        `<button id=\"paybtn\">Simulasikan Pembayaran Sukses</button>`+
        `</div>`+
        `<script>document.getElementById('paybtn').addEventListener('click', ()=>{ window.opener.postMessage({status:'success', orderId:'${orderId}', method:'${method}'}, '*'); window.close(); });</script>`+`</body></html>`;
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  window.open(url, '_blank');
}

// Menerima pesan dari jendela pembayaran simulasi
window.addEventListener('message', e=>{
  if(!e.data || !e.data.status) return;
  if(e.data.status === 'success'){
    document.getElementById('payment-status').innerText = 'Pembayaran berhasil! (Order: '+e.data.orderId+', Metode: '+e.data.method.toUpperCase()+')';
    // di implementasi nyata: refresh status dari server, verifikasi signature, dsb.
    cart = []; // kosongkan keranjang
  }
});

// autoplay open if checkbox set
window.addEventListener('load', ()=>{
  if(document.getElementById('auto-open').checked){ document.getElementById('to-step-2').click(); }
});

  </script>
</body>
</html>
